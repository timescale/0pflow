// generated/workflows/url-summarizer.ts
// Auto-generated by compile-workflow skill - do not edit directly
import { z } from "zod";
import { Workflow, httpGet } from "0pflow";
import { pageSummarizer } from "../../agents/page-summarizer.js";

// Input schema
const UrlSummarizerInputSchema = z.object({
  url: z.string(),
});
type UrlSummarizerInput = z.infer<typeof UrlSummarizerInputSchema>;

// Output schema
const UrlSummarizerOutputSchema = z.object({
  status: z.enum(["success", "error"]),
  status_code: z.number(),
  summary: z.string().nullable(),
  error: z.string().nullable(),
});
type UrlSummarizerOutput = z.infer<typeof UrlSummarizerOutputSchema>;

export const urlSummarizer = Workflow.create({
  name: "url-summarizer",
  version: 1,
  inputSchema: UrlSummarizerInputSchema,
  outputSchema: UrlSummarizerOutputSchema,

  async run(ctx, inputs: UrlSummarizerInput): Promise<UrlSummarizerOutput> {
    // Task 1: Fetch URL
    // Make an HTTP GET request to fetch the page content.
    const response = await ctx.run(httpGet, { url: inputs.url });

    // Task 2: Check Status
    // Route based on HTTP response status.
    if (response.status !== 200) {
      return {
        status: "error",
        status_code: response.status,
        summary: null,
        error: null,
      };
    }

    // Task 3: Summarize Page
    // Generate a 1-paragraph summary of the page content.
    const result = await ctx.run(pageSummarizer, { content: response.body });

    return {
      status: "success",
      status_code: response.status,
      summary: result.summary,
      error: null,
    };
  },
});
